apiVersion: camel.apache.org/v1alpha1
kind: Kamelet
metadata:
  name: k-mq-message-receiver
  labels:
    camel.apache.org/kamelet.type: "source"
spec:
  definition:
    title: "K-MQ Message Receiver (Generic JMS)"
    description: "Consumes messages from JMS queues using external connection factory, logs receipt details, and routes messages for further processing"
    required: [destination]
    properties:
      destination:
        title: "MQ destination (queue)"
        type: string
        description: "Queue name to consume messages from"
      connectionFactory:
        title: "Connection Factory Reference"
        type: string
        description: "Reference to JMS connection factory bean (e.g., #jmsConnectionFactory)"
        default: "#jmsConnectionFactory"
      concurrentConsumers:
        title: "Concurrent Consumers"
        type: integer
        description: "Number of concurrent consumers for parallel message processing"
        default: 1
      autoStartup:
        title: "Auto Startup"
        type: boolean
        description: "Whether to auto-start the consumer"
        default: true
  template:
    from:
      uri: "jms:queue:{{destination}}?connectionFactory={{connectionFactory}}&concurrentConsumers={{concurrentConsumers}}&autoStartup={{autoStartup}}"
      steps:
        - log:
            message: "[K-MQ-MESSAGE-RECEIVER] Message received from queue: {{destination}}, MessageId: ${header.JMSMessageID}, CorrelationId: ${header.JMSCorrelationID:${header.JMSMessageID}}"
        - setHeader:
            name: "ReceivedTimestamp"
            simple: "${date:now:yyyy-MM-dd'T'HH:mm:ss.SSSZ}"
        - setHeader:
            name: "SourceQueue"
            constant: "{{destination}}"