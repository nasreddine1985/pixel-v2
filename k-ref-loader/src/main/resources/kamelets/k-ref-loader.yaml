id: "k-ref-loader"
title: "K-Reference Loader"
description: "Enriches incoming XML by calling an external REST service and returns enriched XML."
icon: "data:image/png;base64,"
labels:
  - "integration"
  - "xml"
  - "enricher"
properties:
  serviceUrl:
    title: "Service URL"
    description: "The HTTP endpoint used to enrich the XML."
    type: string
    required: true
    default: "${refloader.serviceUrl}"
definition:
  title: "K-Ref Loader Kamelet"
  description: "Route receives XML payload, calls HTTP POST to enrich and returns enriched XML"
  required: [serviceUrl]
  steps:
    - from:
        uri: "kamelet:source"
        parameters: {}
        steps:
          - to:
              uri: "log:ref-loader?level=INFO"
          - set-header:
              ref: "CamelHttpMethod"
              constant: "POST"
          - set-header:
              ref: "Content-Type"
              constant: "application/xml"
          - to:
              uri: "{{serviceUrl}}?bridgeEndpoint=true&throwExceptionOnFailure=false"
          - choice:
              when:
                - simple: "${body} != null"
                  steps:
                    - to: "log:ref-loader?level=DEBUG"
              otherwise:
                - set-body:
                    constant: "<error>enrichment-failed</error>"
          - to: "kamelet:sink"
